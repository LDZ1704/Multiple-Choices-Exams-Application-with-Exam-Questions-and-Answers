{% extends 'layout/base.html' %}

{% block content %}
<!-- slider -->
<div class="container mb-3 p-2 shadow rounded">
    <div id="heroSlider" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{{ url_for('static', filename='images/demo.png') }}"
                     class="d-block rounded" alt="Slide 1">
            </div>
            <div class="carousel-item">
                <img src="{{ url_for('static', filename='images/home.jpg') }}"
                     class="d-block rounded" alt="Slide 2">
            </div>
            <div class="carousel-item">
                <img src="{{ url_for('static', filename='images/login&register.jpg') }}"
                     class="d-block rounded" alt="Slide 3">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroSlider"
                data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroSlider"
                data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
</div>

<!-- Thông tin đề thi -->
<div class="container bg-white shadow rounded p-4 mb-5">
    <div class="row g-4">
        <div class="col-md-3 text-center">
            <img src="{{ exam.image or url_for('static', filename='images/demo.png') }}"
                 class="img-fluid rounded border" alt="{{ exam.exam_name }}">
        </div>
        <div class="col-md-6">
            <h5 class="fw-bold">{{ exam.exam_name }}</h5>
            <div class="text-muted mb-2">Tác giả: {{ exam.createBy if exam.createBy else 'Ẩn danh' }}</div>
            <div class="mb-2">
                <i class="bi bi-calendar-event"></i> {{ exam.createAt.strftime('%d/%m/%Y') }}
            </div>
            <div class="mb-2">
                <strong>Môn học:</strong> {{ exam.subject.subject_name }}
            </div>
            <div class="mb-2">
                <span class="badge bg-primary me-2">
                    <i class="bi bi-bar-chart"></i> {{ stats.avg_score }}/100
                </span>
                <span class="badge bg-info text-dark me-2">
                    <i class="bi bi-person"></i> {{ stats.total_attempts }} lượt thi
                </span>
                <span class="badge bg-success">
                    <i class="bi bi-question-circle"></i> {{ question_count }} câu hỏi
                </span>
            </div>
        </div>
        <div class="col-md-3 text-center">
            <div class="mb-2 fw-bold">Chia sẻ đề thi</div>
            <div class="d-flex justify-content-center mb-3">
                <a href="#" class="btn btn-outline-primary btn-sm me-1 hover-underline-center"><i class="bi bi-facebook"></i></a>
                <a href="#" class="btn btn-outline-info btn-sm me-1 hover-underline-center"><i class="bi bi-linkedin"></i></a>
                <a href="#" class="btn btn-outline-dark btn-sm hover-underline-center"><i class="bi bi-x"></i></a>
            </div>
            <div class="d-flex justify-content-center mb-3">------------------- Hoặc -------------------</div>
            <div class="d-grid gap-2 mb-2">
                <button class="btn btn-outline-secondary btn-sm hover-underline-center" onclick="copyToClipboard()">
                    <i class="bi bi-link-45deg"></i> Sao chép link
                </button>
                <button class="btn btn-outline-primary btn-sm hover-underline-center"><i class="bi bi-qr-code-scan"></i> Quét mã QR</button>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12 d-grid">
            {% if current_user.is_authenticated %}
                {% set student = current_user.student %}
                {% if student %}
                    {% set existing_session = dao.get_exam_session(student.id, exam.id) %}
                    {% if existing_session and not existing_session.is_completed %}
                        <div class="notification-box notification-danger mb-3" style="color: #f0ad4e;">
                            <div class="notification-content">
                                <i class="fas fa-clock notification-icon"></i>
                                <div class="notification-text">
                                    <strong>Bạn có bài thi chưa hoàn thành!</strong>
                                    <div class="small">
                                        Câu đã làm: {{ existing_session.user_answers|length if existing_session.user_answers else 0 }}/{{ question_count }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <a href="{{ url_for('doing_exam', exam_id=exam.id) }}" class="btn btn-warning btn-lg w-100 hover-underline-center d-flex align-items-center justify-content-center">
                                    <i class="fas fa-play me-2"></i>Tiếp tục làm bài
                                </a>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-danger w-100 hover-underline-center d-flex align-items-center justify-content-center" onclick="confirmRestartExam()" style="height: 48px; font-size: 20px;">
                                    <i class="fas fa-redo me-2"></i>Làm lại từ đầu
                                </button>
                            </div>
                        </div>
                    {% elif has_result %}
                        <div class="notification-box notification-success mb-3" style="color: #155724;">
                            <div class="notification-content">
                                <i class="fas fa-check-circle notification-icon"></i>
                                <div class="notification-text">
                                    <strong>Bạn đã hoàn thành bài thi này!</strong>
                                    <div class="small-text">Điểm số cao nhất: {{ highest_score }}/100</div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                {% set latest_result = user_results[0] if user_results else None %}
                                {% if latest_result %}
                                    <a href="{{ url_for('view_exam_result', result_id=latest_result.id) }}"
                                       class="btn btn-primary btn-lg w-100 hover-underline-center" style="background: #384AD5;">
                                        <i class="fas fa-eye me-2"></i>Xem kết quả
                                    </a>
                                {% endif %}
                            </div>
                            <div class="col-6">
                                <a href="{{ url_for('doing_exam', exam_id=exam.id) }}"
                                   class="btn btn-outline-primary btn-lg w-100 hover-underline-center">
                                    <i class="fas fa-redo me-2"></i>Bắt đầu ôn thi lại
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <a href="{{ url_for('doing_exam', exam_id=exam.id) }}"
                           class="btn fs-5 text-white text-decoration-none hover-underline-center mb-3" style="background: #384AD5;">
                            <i class="bi bi-play-circle"></i> Bắt đầu ôn thi
                        </a>
                    {% endif %}
                {% endif %}
            {% else %}
                <a href="{{ url_for('login', next=url_for('exam_detail', id=exam.id)) }}"
                   class="btn fs-5 text-white text-decoration-none hover-underline-center mb-3" style="background: #384AD5;">
                    <i class="bi bi-play-circle"></i> Bắt đầu ôn thi
                </a>
            {% endif %}
        </div>
    </div>

    <div class="notification-box notification-warning mt-2">
        <div class="notification-content">
            <i class="bi bi-info-circle-fill notification-icon"></i>
            <div class="notification-text small-text">
                Tài liệu ôn thi chỉ có giá trị tham khảo và ôn tập, không phải đề thi thực tế.
            </div>
        </div>
    </div>
</div>

<!-- Tab content -->
<div class="container">
    <div class="card shadow-sm p-4 mb-5">
        <div class="card-body">
            <ul class="nav nav-tabs mb-3" id="examTabs">
                <li class="nav-item">
                    <a class="nav-link active" data-bs-toggle="tab" href="#reviews" id="reviews-tab">
                        Bình luận ({{ comments_pagination.total }})
                    </a>
                </li>
                {% if current_user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link" data-bs-toggle="tab" href="#results" id="results-tab">
                        Kết quả ôn tập ({{ user_results|length if user_results else 0 }})
                    </a>
                </li>
                {% endif %}
            </ul>

            <div class="tab-content">
                <!-- Tab bình luận -->
                <div class="tab-pane fade show active" id="reviews">
                    {% if current_user.is_authenticated %}
                    <div class="card mb-4 border-primary">
                        <div class="card-body">
                            <h6 class="card-title">Viết bình luận</h6>
                            <form method="POST" action="{{ url_for('add_exam_comment') }}">
                                <input type="hidden" name="exam_id" value="{{ exam.id }}">
                                <div class="mb-3">
                                    <textarea class="form-control" name="content" rows="3"
                                              placeholder="Chia sẻ cảm nhận của bạn về đề thi này..."></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary hover-underline-center" style="background-color: #384AD5;">Gửi bình luận</button>
                            </form>
                        </div>
                    </div>
                    {% else %}
                    <div class="notification-box notification-info">
                        <div class="notification-content">
                            <i class="bi bi-info-circle notification-icon"></i>
                            <div class="notification-text">
                                <a href="{{ url_for('login', next=url_for('exam_detail', id=exam.id)) }}" class="login-link">Đăng nhập</a>
                                để viết đánh giá và xem kết quả ôn tập.
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Danh sách bình luận -->
                    {% if comments_pagination.items %}
                    {% for comment in comments_pagination.items %}
                    <div class="card mb-3 border border-light shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div class="d-flex align-items-center">
                                    <img src="{{ comment.user.avatar or url_for('static', filename='images/demo.png') }}"
                                         class="img-fluid rounded-circle me-3"
                                         style="width: 3rem; height: 3rem;" alt="avatar">
                                    <div>
                                        <strong>{{ comment.user.name }}</strong>
                                        <br>
                                        <small class="text-muted">{{ 'Quản trị viên' if comment.user.role.name ==
                                            'ADMIN' else 'Học sinh' }}</small>
                                    </div>
                                </div>
                                <small class="text-muted">
                                    {{ comment.created_at.strftime('%H:%M - %d/%m/%Y') }}
                                </small>
                            </div>
                            <div class="text-body">
                                <p class="mb-0">{{ comment.content }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                    <!-- Phân trang đánh giá -->
                    {% if comments_pagination.pages > 1 %}
                    <nav aria-label="Comments pagination" id="comments-pagination">
                        <ul class="pagination justify-content-center">
                            {% if comments_pagination.has_prev %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?id={{ exam.id }}&comment_page={{ comments_pagination.prev_num }}">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                            </li>
                            {% endif %}

                            {% for page_num in comments_pagination.iter_pages() %}
                            {% if page_num %}
                            {% if page_num != comments_pagination.page %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?id={{ exam.id }}&comment_page={{ page_num }}">
                                    {{ page_num }}
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item active">
                                <span class="page-link">{{ page_num }}</span>
                            </li>
                            {% endif %}
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">…</span>
                            </li>
                            {% endif %}
                            {% endfor %}

                            {% if comments_pagination.has_next %}
                            <li class="page-item">
                                <a class="page-link"
                                   href="?id={{ exam.id }}&comment_page={{ comments_pagination.next_num }}">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    {% endif %}
                    {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-chat-dots fs-1"></i>
                        <p class="mt-2">Chưa có đánh giá nào cho đề thi này.</p>
                        {% if current_user.is_authenticated %}
                        <p>Hãy là người đầu tiên đánh giá!</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <!-- Tab Kết quả ôn tập -->
                {% if current_user.is_authenticated %}
                <div class="tab-pane fade" id="results">
                    {% if user_results %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                            <tr>
                                <th>Lần thi</th>
                                <th>Điểm số</th>
                                <th>Thời gian làm bài</th>
                                <th>Ngày thi</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for result in user_results %}
                            <tr>
                                <td>{{ loop.revindex }}</td>
                                <td>
                                    <span class="badge {% if result.score >= 80 %}bg-success{% elif result.score >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ result.score }}/100
                                    </span>
                                </td>
                                <td>{{ exam.duration }} phút</td>
                                <td>{{ result.taken_exam.strftime('%H:%M %d/%m/%Y') }}</td>
                                <td>
                                    {% if result.score >= 50 %}
                                    <span class="text-success">Đạt</span>
                                    {% else %}
                                    <span class="text-danger">Không đạt</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('view_exam_result', result_id=result.id) }}"
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> Xem chi tiết
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Thống kê cá nhân -->
                    <div class="row mt-4">
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-primary">{{ user_results|length }}</h5>
                                    <p class="card-text">Số lần thi</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-success">
                                        {% if user_results|length > 0 %}
                                        {{ "%.1f"|format((user_results|sum(attribute='score'))/user_results|length)
                                        }}/100
                                        {% else %}
                                        0/100
                                        {% endif %}
                                    </h5>
                                    <p class="card-text">Điểm trung bình</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-warning">
                                        {{ user_results|selectattr('score', '>=', 5)|list|length }}
                                    </h5>
                                    <p class="card-text">Số lần đạt</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-graph-up fs-1"></i>
                        <p class="mt-2">Bạn chưa thi đề này.</p>
                        <a href="{{ url_for('doing_exam', exam_id=exam.id) }}" class="btn text-white text-decoration-none hover-underline-center" style="background: #384AD5;">
                            <i class="bi bi-play-circle"></i> Bắt đầu thi ngay
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modal xác nhận làm lại lúc còn đang làm -->
<div class="modal fade" id="restartExamModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient text-white border-0"
                 style="background: linear-gradient(135deg, #ff416c 0%, #ff4757 100%);">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-redo me-2"></i>Xác nhận làm lại từ đầu
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="text-center mb-4">
                    <i class="fas fa-exclamation-triangle text-danger fs-1 mb-3"></i>
                    <h5 class="fw-bold">Bạn có chắc chắn muốn làm lại bài thi không?</h5>
                    <p class="text-muted">Toàn bộ tiến trình hiện tại sẽ bị xóa và không thể khôi phục.</p>
                </div>

                <div class="row g-3">
                    <div class="col-6">
                        <div class="text-center p-3 bg-success bg-opacity-10 rounded-3">
                            <i class="fas fa-check-circle text-white fs-3 mb-2"></i>
                            <h3 class="mb-0 text-white fw-bold" id="restart-answered-count">0</h3>
                            <small class="text-white">Câu đã làm</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center p-3 bg-warning bg-opacity-10 rounded-3">
                            <i class="fas fa-trash-alt text-danger fs-3 mb-2"></i>
                            <h3 class="mb-0 text-danger fw-bold">SẼ MẤT</h3>
                            <small class="text-danger">Tiến trình</small>
                        </div>
                    </div>
                </div>

                <!-- Thêm thông tin thời gian đã dùng (nếu có) -->
                <div class="alert alert-warning mt-2">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-clock me-2"></i>
                        <div>
                            <strong>Thời gian đã làm bài:</strong>
                            <span id="restart-time-used">0 phút</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 p-4">
                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Hủy
                </button>
                <button type="button" class="btn btn-danger rounded-pill px-4" data-exam-id="{{ exam.id }}" data-answered-count="{{ session.user_answers|length if session.user_answers else 0 }}" onclick="restartExam()">
                    <i class="fas fa-redo me-2"></i>Làm lại từ đầu
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal xác nhận làm lại bài thi sau khi làm 1 lần -->
<div class="modal fade" id="retakeExamModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient text-white border-0"
                 style="background: linear-gradient(135deg, #384AD5 0%, #5a67d8 100%);">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-redo me-2"></i>Bắt đầu ôn thi lại
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="text-center mb-4">
                    <i class="fas fa-question-circle text-primary fs-1 mb-3"></i>
                    <h5 class="fw-bold">Bạn có muốn làm lại bài thi này không?</h5>
                    <p class="text-muted">Bạn sẽ tạo một phiên thi mới và có thể cải thiện điểm số của mình.</p>
                </div>

                <div class="notification-box notification-info">
                    <div class="notification-content">
                        <i class="bi bi-info-circle notification-icon"></i>
                        <div class="notification-text small-text">
                            Điểm số cao nhất của bạn sẽ được lưu lại để so sánh.
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 p-4">
                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Hủy
                </button>
                <button type="button" class="btn btn-primary rounded-pill px-4" onclick="retakeExam()" style="background: #384AD5;">
                    <i class="fas fa-play me-2"></i>Bắt đầu làm bài
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    const userAnswers = {{ (existing_session.user_answers | tojson) if existing_session and existing_session.user_answers else '{}' }};
    window.sessionData = {
        user_answers: userAnswers
    };

    function confirmRestartExam() {
        updateRestartModalStats();

        const modal = new bootstrap.Modal(document.getElementById('restartExamModal'));
        modal.show();
    }

    function updateRestartModalStats() {
        const answeredCount = (typeof userAnswers !== 'undefined' && userAnswers)
            ? Object.keys(userAnswers).length
            : (window.sessionData && window.sessionData.user_answers)
                ? Object.keys(window.sessionData.user_answers).length
                : 0;

        document.getElementById('restart-answered-count').textContent = answeredCount;

        const examDuration = {{ exam.duration }};

        {% if session and session.start_time %}
            const startTime = new Date('{{ session.start_time.isoformat() }}');
            {% if session.is_paused and session.pause_time%}
                const endTime = new Date('{{ session.pause_time.isoformat() }}');
                const totalElapsedSeconds = Math.floor((endTime - startTime) / 1000);

                const pausedDuration = {{ session.total_paused_duration or 0 }};
                const actualUsedTime = Math.max(0, totalElapsedSeconds - pausedDuration);

                const usedMinutes = Math.floor(actualUsedTime / 60);
                const usedSeconds = actualUsedTime % 60;
            {% else %}
                const actualUsedTime = 0;
            {% endif %}
            let timeText = '';
            if (usedMinutes > 0) {
                timeText = `${usedMinutes} phút`;
                if (usedSeconds > 0) {
                    timeText += ` ${usedSeconds} giây`;
                }
            } else {
                timeText = `${Math.max(0, usedSeconds)} giây`;
            }
            
            document.getElementById('restart-time-used').textContent = timeText;

            const timeAlert = document.querySelector('#restartExamModal .alert-warning');
            if (timeAlert) {
                timeAlert.style.display = 'block';
            }
        {% else %}
            const timeAlert = document.querySelector('#restartExamModal .alert-warning');
            if (timeAlert) {
                timeAlert.style.display = 'none';
            }
        {% endif %}
    }

    function restartExam() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('restartExamModal'));
        modal.hide();

        const examId = getExamId();

        if (!examId) {
            alert('Không thể xác định bài thi!');
            return;
        }

        showLoadingOverlay('Đang reset bài thi...', 'Vui lòng đợi trong giây lát');

        fetch(`/api/exam/${examId}/restart`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                window.location.href = `/doing-exam/${examId}?restart=1`;
            } else {
                showErrorOverlay('Lỗi: ' + (data.error || 'Không thể reset bài thi'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showErrorOverlay('Không thể kết nối tới máy chủ');
        });
    }

    function getExamId() {
        if (typeof examId !== 'undefined') return examId;

        const urlParams = new URLSearchParams(window.location.search);
        const urlExamId = urlParams.get('id') || urlParams.get('exam_id');
        if (urlExamId) return urlExamId;

        const pathMatch = window.location.pathname.match(/doing-exam\/(\d+)/);
        if (pathMatch) return pathMatch[1];

        const examElement = document.querySelector('[data-exam-id]');
        if (examElement) return examElement.dataset.examId;

        return null;
    }

    function showLoadingOverlay(title, message) {
        const container = document.querySelector('.container-fluid') || document.body;
        container.innerHTML = `
            <div class="text-center py-5">
                <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">${title}</span>
                </div>
                <h4>${title}</h4>
                <p class="text-muted">${message}</p>
            </div>
        `;
    }

    function showErrorOverlay(errorMessage) {
        const container = document.querySelector('.container-fluid') || document.body;
        container.innerHTML = `
            <div class="alert alert-danger text-center py-5">
                <i class="fas fa-exclamation-triangle fs-1 mb-3"></i>
                <h4>${errorMessage}</h4>
                <button class="btn btn-primary mt-3" onclick="window.location.reload()">
                    <i class="fas fa-redo me-2"></i>Thử lại
                </button>
            </div>
        `;
    }

    function confirmRetakeExam() {
        const modal = new bootstrap.Modal(document.getElementById('retakeExamModal'));
        modal.show();
    }

    function retakeExam() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('retakeExamModal'));
        modal.hide();

        const examId = getExamId();

        if (!examId) {
            alert('Không thể xác định bài thi!');
            return;
        }

        showLoadingOverlay('Đang khởi tạo bài thi mới...', 'Vui lòng đợi trong giây lát');

        window.location.href = `/doing-exam/${examId}`;
    }
</script>

{% endblock %}